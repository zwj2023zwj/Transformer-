import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import io

# 1. 准备您的数据
# 将您提供的CSV数据放入一个多行字符串中
csv_data = """Epoch,Train Loss,Validation Loss
1,1.412359,1.370149
2,1.358132,1.325765
3,1.309480,1.286816
4,1.277465,1.254448
5,1.251933,1.234115
6,1.232491,1.215398
7,1.217560,1.198726
8,1.203521,1.189834
9,1.192404,1.179532
10,1.183307,1.171815
11,1.175121,1.166627
12,1.167971,1.160687
13,1.160699,1.156265
14,1.155824,1.153111
15,1.151332,1.150074
16,1.145624,1.147595
17,1.141636,1.143574
18,1.135542,1.142155
19,1.132004,1.139455
20,1.128540,1.137663
21,1.123226,1.138232
22,1.120761,1.134244
23,1.117177,1.133485
24,1.113551,1.131080
25,1.110989,1.130257
26,1.106568,1.130084
27,1.103966,1.128571
28,1.102036,1.127695
29,1.097588,1.126559
30,1.097586,1.126201
31,1.092592,1.125816
32,1.091060,1.124256
33,1.088517,1.123815
34,1.085264,1.123645
35,1.084684,1.122485
36,1.082527,1.121409
37,1.080288,1.121104
38,1.079347,1.120954
39,1.075678,1.122165
40,1.074922,1.120231
41,1.073448,1.120280
42,1.071021,1.119668
43,1.071055,1.118350
44,1.067948,1.119170
45,1.066882,1.118162
46,1.066026,1.117741
47,1.063216,1.117706
48,1.063478,1.117307
49,1.062137,1.117492
50,1.060298,1.116546
51,1.060513,1.115675
52,1.056678,1.116139
53,1.058255,1.115654
54,1.056504,1.115687
55,1.055175,1.115174
56,1.055048,1.114284
57,1.052338,1.114997
58,1.051899,1.114373
59,1.052113,1.113445
60,1.049479,1.114143
61,1.050628,1.113254
62,1.049010,1.113668
63,1.048250,1.112683
64,1.048739,1.112304
65,1.045752,1.112918
66,1.046001,1.111951
67,1.046422,1.111914
68,1.042964,1.111806
69,1.044452,1.111056
70,1.041925,1.111501
71,1.042387,1.110543
72,1.041344,1.110109
73,1.039945,1.110451
74,1.040631,1.110136
75,1.039428,1.110581
76,1.037726,1.109594
77,1.038618,1.109568
78,1.036626,1.110253
79,1.038403,1.109110
80,1.037190,1.110029
81,1.036437,1.108989
82,1.036528,1.108606
83,1.034950,1.108977
84,1.035039,1.108075
85,1.034276,1.108098
86,1.032946,1.108376
87,1.034021,1.107486
88,1.031968,1.108649
89,1.031440,1.106652
90,1.032231,1.106182
91,1.029966,1.107573
92,1.030712,1.106314
93,1.030472,1.106589
94,1.028636,1.106822
95,1.030315,1.105589
96,1.028369,1.107228
97,1.027950,1.105899
98,1.028664,1.105328
99,1.025637,1.106201
100,1.027513,1.105597
"""

# 使用io.StringIO将字符串模拟成文件，然后用pandas读取
df = pd.read_csv(io.StringIO(csv_data))

# 2. 计算困惑度 (Perplexity)
# PPL = exp(loss)
df['Train PPL'] = np.exp(df['Train Loss'])
df['Validation PPL'] = np.exp(df['Validation Loss'])

# 打印转换后的数据的前几行，进行检查
print(df.head())

# 3. 绘制PPL曲线
plt.style.use('seaborn-v0_8-whitegrid') # 使用一个美观的绘图风格
fig, ax = plt.subplots(figsize=(12, 7)) # 创建画布和坐标轴，并设置大小

# 绘制训练PPL曲线
ax.plot(df['Epoch'], df['Train PPL'], label='Training PPL', color='royalblue', linewidth=2)

# 绘制验证PPL曲线
ax.plot(df['Epoch'], df['Validation PPL'], label='Validation PPL', color='darkorange', linewidth=2)

# 添加图表元素
ax.set_title('Training and Validation Perplexity (PPL)', fontsize=16)
ax.set_xlabel('Epoch', fontsize=12)
ax.set_ylabel('Perplexity (PPL)', fontsize=12)
ax.legend(fontsize=12) # 显示图例

# 设置坐标轴范围，可以根据需要调整
# ax.set_ylim(2.4, 3.5) 

# 显示网格
ax.grid(True)

# 显示图表
# plt.show()
plt.savefig('training_validation_ppl_curve.png')